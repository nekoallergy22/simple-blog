---
title: "教師あり学習：回帰問題とアンサンブル"
date: "2025-6-29"
tags: ["回帰", "アンサンブル", "ランダムフォレスト"]
section: "ai"
slug: "10-supervised-learning-regression-ensemble"
difficulty: "beginner"
number: 10
---

「この地域の家を売ったら、いくらになるだろう？」「来月の売上はどのくらいになる？」「この患者の血圧はどこまで下がる？」私たちの日常には、カテゴリ分けではなく **具体的な数値を予測したい** 場面がたくさんあります。また、一つの手法だけでは限界がある時、複数の手法を組み合わせてより正確な予測を行う技術もあります。この記事では、**回帰問題** と **アンサンブル学習** について詳しく解説します。

## 回帰問題とは？

**回帰問題とは、与えられたデータから連続的な数値を予測する問題** です。分類問題が「どのカテゴリに属するか」を答えるのに対し、回帰問題は「どのくらいの値になるか」を答えます。

### 分類問題と回帰問題の違い

**分類問題**：
- 出力：離散的な値（カテゴリ）
- 例：「迷惑メール」か「普通のメール」か
- 例：「犬」「猫」「鳥」のどれか

**回帰問題**：
- 出力：連続的な値（数値）
- 例：不動産価格「3,500万円」
- 例：明日の気温「23.5度」

要するに、「分類は選択肢から選ぶ」のに対し、「回帰は具体的な数値を推定する」問題です。

### 回帰問題の具体例

**不動産価格予測**：
- 入力：立地、面積、築年数、駅からの距離、間取り
- 出力：価格（例：3,200万円）

**売上予測**：
- 入力：過去の売上データ、季節、プロモーション情報、経済指標
- 出力：来月の売上（例：1,250万円）

**医療データ分析**：
- 入力：患者の年齢、体重、既往歴、薬の投与量
- 出力：血圧の変化量（例：-15mmHg）

**株価予測**：
- 入力：過去の株価、取引量、企業業績、経済指標
- 出力：明日の株価（例：2,350円）

## 線形回帰：回帰の基礎

**線形回帰** は、回帰問題の最も基本的な手法です。データの関係性を一本の直線で表現しようとします。

### 単純線形回帰

**単純線形回帰** は、一つの入力変数から出力を予測します。

**たとえば、家の面積から価格を予測**：
```
価格 = 面積 × 単価 + 基本価格
価格 = 100㎡ × 30万円/㎡ + 500万円 = 3,500万円
```

この式の「30万円/㎡（単価）」と「500万円（基本価格）」をデータから自動的に学習します。

**グラフで表現すると**：
- X軸：面積
- Y軸：価格
- データ点に最も近い直線を引く

### 重回帰分析

**重回帰分析** は、複数の入力変数を使って予測の精度を向上させます。

**たとえば、より詳細な不動産価格予測**：
```
価格 = 面積×係数1 + 築年数×係数2 + 駅距離×係数3 + 基本価格
価格 = 100㎡×30万 + 5年×(-20万) + 5分×(-10万) + 800万円
     = 3,000万 - 100万 - 50万 + 800万 = 3,650万円
```

### 線形回帰の長所と短所

**長所**：
- 理解しやすく、解釈が容易
- 計算が高速で効率的
- 「どの要素がどのくらい影響するか」が明確

**短所**：
- 直線的な関係しか表現できない
- 複雑な関係性（曲線的な関係）を捉えられない
- 外れ値に敏感

## カーネル法：非線形関係の捉え方

現実のデータは、必ずしも直線的な関係にあるとは限りません。**カーネル法** は、複雑な曲線的関係も扱える技術です。

### カーネルの基本概念

**カーネル** とは、データを高次元空間に変換する数学的な技法です。元の空間では直線で分けられないデータも、高次元空間では直線（平面）で分けられるようになります。

**たとえば、気温と冷房の電力使用量の関係**：
- 20度以下：冷房を使わない（電力使用量は低い）
- 20-25度：少し使う（電力使用量は中程度）
- 25度以上：頻繁に使う（電力使用量は高い）

この関係は直線ではなく、曲線になります。カーネル法を使うことで、このような複雑な関係も正確に予測できます。

### 主要なカーネル

**多項式カーネル**：
データ間の関係を多項式（2次式、3次式など）で表現

**RBF（ガウシアン）カーネル**：
データ間の類似度をガウス分布で表現。最も一般的に使用される

**シグモイドカーネル**：
ニューラルネットワークと類似した特性を持つ

## アンサンブル学習：複数手法の力の結集

**アンサンブル学習とは、複数の学習アルゴリズムを組み合わせて、単一の手法よりも高い精度を実現する技術** です。「三人寄れば文殊の知恵」のように、複数のモデルの判断を総合することで、より正確な予測ができます。

### アンサンブル学習の基本的な考え方

一つのモデルが間違えても、他のモデルが正しい判断をしていれば、全体としては正確な結果が得られます。

**たとえば、株価予測の場合**：
- **モデルA**：テクニカル分析重視 → 明日は上昇
- **モデルB**：企業業績重視 → 明日は下降  
- **モデルC**：経済指標重視 → 明日は上昇
- **総合判断**：3つのうち2つが「上昇」→ 上昇予測

### AdaBoost（適応的ブースティング）

**AdaBoost** は、弱い学習器を順次組み合わせて、強い学習器を作る手法です。

**基本的な仕組み**：
1. 最初のモデルでデータを学習
2. 間違えたデータにより大きな重要度を設定
3. 重要度を考慮した2番目のモデルを学習
4. これを繰り返して最終的に組み合わせ

**たとえば、迷惑メール検出**：
- **1回目**：「無料」という単語で判定（70%の精度）
- **2回目**：1回目で間違えたメールを重視して学習（80%の精度）
- **3回目**：さらに難しいケースを重視（85%の精度）
- **最終**：3つの判定を組み合わせて90%の精度を実現

### ランダムフォレスト

**ランダムフォレスト** は、多数の決定木を組み合わせるアンサンブル手法です。

**基本的な仕組み**：
1. 元のデータからランダムにサンプリングして複数のデータセットを作成
2. それぞれのデータセットで決定木を学習
3. 新しいデータが来たら、全ての決定木で予測
4. 多数決（回帰の場合は平均）で最終判断

**たとえば、100本の決定木で不動産価格予測**：
- 決定木1：3,200万円
- 決定木2：3,400万円
- 決定木3：3,100万円
- ...
- 決定木100：3,350万円
- **最終予測**：全体の平均 = 3,250万円

**ランダムフォレストの利点**：
- 個々の決定木の過学習を抑制
- 高い予測精度
- 特徴量の重要度が分かる
- 比較的解釈しやすい

### 勾配ブースティング

**勾配ブースティング** は、前のモデルの誤差を次のモデルで修正していくアンサンブル手法です。

**基本的な考え方**：
1. 最初のモデルで予測
2. 実際の値と予測値の差（誤差）を計算
3. この誤差を予測する2番目のモデルを学習
4. 1番目の予測 + 2番目の誤差予測 = 改良された予測
5. まだ残る誤差に対して3番目のモデルを学習
6. これを繰り返す

**たとえば、売上予測**：
- **1回目**：1,000万円と予測（実際は1,200万円、誤差+200万円）
- **2回目**：誤差200万円を予測するモデルを追加（190万円と予測）
- **最終予測**：1,000万円 + 190万円 = 1,190万円（誤差10万円に改善）

**代表的な勾配ブースティング**：
- **XGBoost**：高速で高精度、機械学習コンペでよく使われる
- **LightGBM**：より高速化されたバージョン
- **CatBoost**：カテゴリデータの処理に特化

## 実際の応用事例

### 不動産価格予測システム

**大手不動産サイトの価格予測**：
- **ベースモデル**：線形回帰（立地、面積、築年数）
- **高精度モデル**：ランダムフォレスト（100以上の特徴量）
- **最終モデル**：複数手法のアンサンブル

**使用される特徴量**：
- 基本情報：面積、築年数、間取り、構造
- 立地情報：駅距離、学校・病院・商業施設までの距離
- 周辺環境：人口密度、平均所得、犯罪率
- 市場情報：過去の取引価格、在庫数、需要動向

**精度向上の結果**：
- 単純な線形回帰：平均誤差±500万円
- アンサンブル学習：平均誤差±200万円

### 需要予測システム

**小売業の商品需要予測**：
- **目的**：在庫の最適化、機会損失の削減
- **手法**：時系列データの回帰分析 + アンサンブル学習

**考慮要素**：
- 過去の売上トレンド
- 季節性（夏にアイス、冬にコートなど）
- 曜日・祝日の影響
- 天気予報（雨具、冷房など）
- プロモーション・セール情報
- 競合他社の動向

**ビジネス効果**：
- 在庫過多による廃棄ロスの削減：30%減
- 品切れによる機会損失の削減：20%減
- 全体的な収益向上：15%増

### 医療分野の数値予測

**薬物投与量の最適化**：
- **入力**：患者の年齢、体重、腎機能、肝機能、併用薬
- **出力**：適切な薬物投与量
- **手法**：個人差を考慮した回帰モデル

**糖尿病管理**：
- **入力**：血糖値履歴、食事内容、運動量、ストレスレベル
- **出力**：次の測定時の血糖値予測
- **効果**：患者の自己管理能力向上、合併症予防

## モデル評価指標

回帰問題では、予測値と実際の値の差を測定する指標が使われます。

### 平均二乗誤差（MSE）

**MSE** は予測誤差の二乗の平均です：
```
MSE = Σ(実際の値 - 予測値)² / データ数
```

大きな誤差により大きなペナルティを課します。

### 平均二乗平方根誤差（RMSE）

**RMSE** はMSEの平方根で、元の単位で誤差を表現：
```
RMSE = √MSE
```

**たとえば、不動産価格予測で RMSE = 200万円** なら、「平均的に実際の価格から±200万円の誤差がある」という意味です。

### 平均絶対誤差（MAE）

**MAE** は予測誤差の絶対値の平均：
```
MAE = Σ|実際の値 - 予測値| / データ数
```

外れ値の影響を受けにくい指標です。

## まとめ

回帰問題とアンサンブル学習は、現実世界の数値予測において極めて重要な技術です。単純な線形関係から複雑な非線形関係まで、様々な手法を組み合わせることで高精度な予測が可能になります。

**回帰問題の本質**：
- 連続的な数値を予測
- 線形回帰から高度な非線形手法まで
- カーネル法で複雑な関係も表現可能

**アンサンブル学習の威力**：
- **AdaBoost**：弱い学習器を段階的に強化
- **ランダムフォレスト**：多数の決定木の組み合わせ
- **勾配ブースティング**：誤差を段階的に修正

**実用的な価値**：
- 不動産価格、需要予測、医療データ分析
- ビジネスの意思決定支援
- 個人の生活品質向上

**評価の重要性**：
- MSE、RMSE、MAEで精度を測定
- ビジネス価値との関連性を考慮

要するに、回帰とアンサンブルは「過去のデータから未来の数値を正確に予測し、複数の知恵を組み合わせてより良い判断を下す」技術なのです。

次回は、正解ラベルなしでデータの構造を発見する **教師なし学習のクラスタリング** について、その原理と応用を詳しく解説していきます。