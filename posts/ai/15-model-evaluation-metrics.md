---
title: "モデル評価の基本指標"
date: "2025-6-29"
tags: ["混同行列", "正解率", "適合率", "再現率", "F値", "ROC曲線", "AUC"]
section: "ai"
slug: "15-model-evaluation-metrics"
number: 15
category: "強化学習・評価編"
---

機械学習モデルを作ったら、次に気になるのは「このモデルはどれくらい良い性能なの？」ということですよね。でも、「良い性能」って具体的に何を指すのでしょうか？この記事では、機械学習モデルの性能を測るための基本的な指標を、身近な例を使って分かりやすく解説します。

## なぜモデル評価が重要なのか？

**モデル評価とは、作成した機械学習モデルがどれくらい正確に予測できるかを数値で測ること** です。これは、料理の腕前を測るのと似ています。

**たとえば**：

- **料理の評価**：「美味しさ」「見た目」「栄養バランス」「作りやすさ」など、様々な観点から評価
- **モデルの評価**：「正確性」「速度」「安定性」「汎用性」など、様々な観点から評価

評価が重要な理由：

1. **性能の把握**：モデルがどれくらい信頼できるかを知る
2. **モデルの比較**：複数のモデルの中から最適なものを選ぶ
3. **改善の指針**：どこを改善すべきかを明確にする
4. **実用性の判断**：実際のビジネスで使えるレベルかを判断する

要するに、モデル評価は「作ったモデルが本当に役に立つかどうか」を客観的に判断するための手段なのです。

## 混同行列（Confusion Matrix）

**混同行列とは、分類モデルの予測結果を表形式でまとめたもの** です。これを見ることで、モデルがどのような間違いをしているかを詳しく分析できます。

### 2クラス分類の混同行列

最もシンプルな2クラス分類（「Yes」か「No」か）の場合を考えてみましょう。

```
                 実際の答え
                Yes    No
予測結果 Yes    50     5     （予測結果がYesの場合）
        No     10    35     （予測結果がNoの場合）
```

この表の意味：

- **真陽性（True Positive, TP）**: 50件 - 正しく「Yes」と予測
- **偽陽性（False Positive, FP）**: 5件 - 間違って「Yes」と予測
- **偽陰性（False Negative, FN）**: 10件 - 間違って「No」と予測
- **真陰性（True Negative, TN）**: 35件 - 正しく「No」と予測

**たとえば（病気の診断）**：

```
                 実際の状態
                病気    健康
診断結果 病気    80     20    （病気と診断）
        健康    15    885    （健康と診断）
```

- **TP（80）**: 病気の人を正しく「病気」と診断
- **FP（20）**: 健康な人を間違って「病気」と診断
- **FN（15）**: 病気の人を間違って「健康」と診断
- **TN（885）**: 健康な人を正しく「健康」と診断

要するに、混同行列は「どこで正解して、どこで間違えたか」を一目で分かるようにした表なのです。

## 基本的な評価指標

混同行列を使って、様々な評価指標を計算できます。これらの指標は、それぞれ異なる観点からモデルの性能を評価します。

### 正解率（Accuracy）

**正解率とは、全体の予測のうち、正しく予測できた割合** です。

```
正解率 = (TP + TN) / (TP + FP + FN + TN)
```

先ほどの病気診断の例では：
```
正解率 = (80 + 885) / (80 + 20 + 15 + 885) = 965 / 1000 = 96.5%
```

**正解率の特徴**：

- **分かりやすい**：直感的に理解しやすい
- **バランスの良いデータ**に適している
- **データの偏り**があると誤解を招く可能性がある

**たとえば**：
- 健康な人が99%、病気の人が1%のデータで、すべて「健康」と予測するモデルを作ると正解率は99%になりますが、実際には病気の人を一人も見つけられません

### 適合率（Precision）

**適合率とは、「病気」と予測した人のうち、実際に病気だった人の割合** です。

```
適合率 = TP / (TP + FP)
```

病気診断の例では：
```
適合率 = 80 / (80 + 20) = 80 / 100 = 80%
```

**適合率の意味**：
- 「病気」と診断された人の80%が実際に病気
- 20%は健康なのに病気と診断された（誤診）

**適合率が重要な場面**：
- **スパムメール検索**：重要なメールを間違ってスパムと判定したくない
- **商品レコメンド**：興味のない商品を推薦したくない

要するに、適合率は「予測した中で、どれくらいが本当に正しかったか」を表す指標です。

### 再現率（Recall）

**再現率とは、実際に病気の人のうち、正しく「病気」と予測できた人の割合** です。

```
再現率 = TP / (TP + FN)
```

病気診断の例では：
```
再現率 = 80 / (80 + 15) = 80 / 95 = 84.2%
```

**再現率の意味**：
- 実際に病気の人の84.2%を正しく診断できた
- 15.8%は病気なのに健康と診断された（見逃し）

**再現率が重要な場面**：
- **病気の診断**：病気を見逃したくない
- **不正取引の検出**：不正を見逃したくない
- **火災警報システム**：火災を見逃したくない

要するに、再現率は「見つけるべきものを、どれくらい見つけられたか」を表す指標です。

### 適合率と再現率のトレードオフ

**適合率と再現率は、一般的にトレードオフの関係** にあります。つまり、一方を上げようとすると、もう一方が下がる傾向があります。

**たとえば（病気診断）**：

- **厳しい診断基準**：症状が重い人だけを「病気」と診断
  - 適合率：高い（診断した人はほぼ確実に病気）
  - 再現率：低い（軽症の病気を見逃す）

- **緩い診断基準**：少しでも症状があれば「病気」と診断
  - 適合率：低い（健康な人も病気と診断してしまう）
  - 再現率：高い（病気の人をほとんど見つけられる）

このバランスを取るために、次のF値という指標が使われます。

## F値（F-measure）

**F値とは、適合率と再現率の調和平均** です。適合率と再現率の両方を考慮した、バランスの取れた評価指標です。

```
F値 = 2 × (適合率 × 再現率) / (適合率 + 再現率)
```

病気診断の例では：
```
F値 = 2 × (80% × 84.2%) / (80% + 84.2%) = 2 × 67.36% / 164.2% = 82.0%
```

### F値の特徴

- **バランスの取れた評価**：適合率と再現率の両方が高い場合に高い値を取る
- **片方だけが高くてもダメ**：適合率か再現率のどちらかが低いと、F値も低くなる
- **比較に便利**：一つの数値でモデルの性能を比較できる

**たとえば**：

- **モデルA**：適合率90%、再現率50% → F値 = 64.3%
- **モデルB**：適合率70%、再現率80% → F値 = 74.7%

この場合、F値を見るとモデルBの方が総合的に優れていることが分かります。

## ROC曲線とAUC

**ROC曲線（Receiver Operating Characteristic curve）とは、分類モデルの性能を可視化するためのグラフ** です。

### ROC曲線の見方

ROC曲線は、以下の2つの指標をプロットします：

- **横軸：偽陽性率（False Positive Rate, FPR）** = FP / (FP + TN)
- **縦軸：真陽性率（True Positive Rate, TPR）** = TP / (TP + FN) = 再現率

### ROC曲線の解釈

**理想的なモデル**：
- 左上角に近いほど良い（偽陽性率が低く、真陽性率が高い）
- 要するに、「間違った警告は少なく、本当の問題はきちんと検出する」

**ランダムなモデル**：
- 対角線上になる（偽陽性率と真陽性率が同じ）
- 要するに、「当てずっぽうと同じ性能」

### AUC（Area Under Curve）

**AUC とは、ROC曲線の下の面積** です。0から1の値を取り、大きいほど良いモデルです。

- **AUC = 1.0**：完璧なモデル
- **AUC = 0.5**：ランダムと同じ（使い物にならない）
- **AUC = 0.0**：完璧に間違っている（予測を逆にすれば完璧）

**一般的な基準**：
- **AUC > 0.9**：優秀
- **AUC > 0.8**：良好
- **AUC > 0.7**：そこそこ
- **AUC < 0.6**：悪い

要するに、AUCは「モデルの判別能力」を一つの数値で表した指標です。

## 評価指標の使い分け

### 問題の特性による選択

**バランスの取れたデータ**：
- 正解率：シンプルで分かりやすい

**データに偏りがある場合**：
- 適合率・再現率・F値：より詳細な分析が可能

**ビジネス要件による選択**：
- **見逃しが致命的**：再現率を重視（病気診断、不正検出）
- **誤報が問題**：適合率を重視（スパムフィルター、商品推薦）
- **総合的な性能**：F値やAUCを重視

### 複数指標の組み合わせ

実際のプロジェクトでは、複数の指標を組み合わせて総合的に評価することが重要です。

**たとえば**：
1. **AUC**で基本的な判別能力を確認
2. **適合率・再現率**でビジネス要件を満たすかを確認
3. **F値**で総合的なバランスを確認

要するに、一つの指標だけでなく、複数の観点からモデルを評価することが大切です。

## まとめ

モデル評価は、機械学習プロジェクトの成功を決める重要な要素です。混同行列を基に計算される正解率、適合率、再現率、F値、そしてROC曲線とAUCは、それぞれ異なる観点からモデルの性能を評価します。

要するに、これらの指標を適切に使い分けることで、「本当に実用的で信頼できるモデル」を作ることができるのです。

次回は、これらの評価指標をより正確に計算するための交差検証という手法について解説していきます。